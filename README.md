# Photon Fusion 멀티플레이어 for Unity

이 저장소는 Unity 2022.3.2를 기반으로 하며, 상호작용, 상태 관리, 네트워크 게임 로직을 처리할 수 있는 Photon Fusion을 활용했습니다.

## 개요
이 프로젝트는 유니티 엔진과 포톤 퓨전을 사용하여 실시간 멀티플레이어 게임을 개발하는 것을 목표로 진행되었습니다. 단독으로 수행하며, 실시간 데이터 동기화와 네트워크 통신 과정에서 발생하는 주요 문제 해결에 중점을 두었습니다.

## 기술 스택
- **프로그래밍 언어**: C#
- **게임 엔진**: Unity
- **IDE**: Visual Studio
- **네트워킹 라이브러리**: Photon Fusion

## 프로젝트 기간
2023년 10월부터 진행 중

## 주요 기능
- 플레이어 간의 실시간 상호작용 및 이벤트 동기화
- 서버와 클라이언트 간 데이터 동기화를 위한 로직 구현
- 게임 상태 관리 및 네트워크 이벤트 처리

## 핵심 스크립트
- **PlayerInfo**: 서로 동기화가 필요한 대부분의 플레이어 데이터를 업데이트합니다.
- **CharacterHandler**: 캐릭터가 사용하는 핸들러들을 관리합니다.
- **PlayerActionEvents**: 게임 내에서 플레이어가 사용하는 이벤트를 관리합니다.
- **CharacterMovementHandler**: 플레이어의 움직임을 담당합니다.
- **PlayerStateHandler**: 스테이트 머신을 활용해 플레이어의 현재 행동 상태를 애니메이터에 전달합니다.
- **WeaponHandler**: 플레이어가 사용하는 무기들을 관리합니다.
- **HPHandler**: 플레이어의 피격 처리와 사망 처리를 담당합니다.
- **ChatSystem**: 채팅 내용을 UI에 표시해주고 RPC를 통해 다른 클라이언트의 채팅창에 동기화합니다.
- **NetworkRunnerHandler**: 참가자인 네트워크 러너를 생성합니다. 로비에서 게임을 생성하거나 생성된 게임에 참가하게 하며, 게임 모드를 변경해 역할을 부여합니다.
- **Spawner**: 생성된 방 상태를 업데이트해주며 네트워크 이벤트에 응답하여 호출되는 콜백 함수가 있습니다.
- **UIManager**: 진행 상태에 따른 UI 캔버스를 관리합니다.
- **GameManager**: 게임의 규칙과 시작, 종료를 정의하고 플레이어에게 상태를 제공합니다.

## 사용된 설계 패턴

- **컴포넌트 기반 설계**: 이동, 체력 관리, 무기 시스템 등 각각의 기능을 독립된 컴포넌트로 설계하여 단일 책임 원칙을 준수합니다.
- **상태 머신**: 플레이어 상태를 관리하고 유지 보수성을 높이기 위해 상태 머신을 적극적으로 활용합니다.
- **옵저버 패턴**: 이벤트 기반의 설계를 통해 게임 내 다양한 상황에 컴포넌트가 효과적으로 반응할 수 있도록 합니다.
- **네트워크 속성 동기화**: Photon Fusion의 네트워크 속성을 활용하여 모든 클라이언트에서 게임 상태를 일관되게 유지합니다.

## 조작 방법
### 키보드
- **이동**: A/D 키
- **공격**: 마우스 좌클릭
- **점프**: 스페이스바
- **채팅**: 엔터 키
### 게임패드
- **이동**: Left Stick
- **공격**: Button South
- **점프**: Button East

## 문제점
네트워크 통신에 대한 이해가 부족해 개발 초기에 네트워크 지연과 데이터 불일치 문제에 부딪혔습니다.
데이터 동기화를 이해하지 못해 예상치 못한 버그와 오류가 많이 발생했고, 이를 해결하는 데 상당한 시간이 걸렸습니다.

## 해결 방법 및 학습
- **네트워크 이론 학습**: 네트워크 프로토콜과 데이터 패키징 기법에 대한 학습을 통해 문제의 원인을 파악하고 해결책을 마련했습니다.
- **문서 분석 및 적용**: Photon Fusion의 공식 문서를 분석하여 네트워크 이벤트 처리 방법을 향상시켰습니다.
